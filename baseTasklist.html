<html>
	<body>
		<a id="saveBtn" href="#">Save this tasklist</a>
		<div class="task" id="root" data-level=0>
			<input class="check" type="checkbox" data-state="false"></input>
			<span class="nameBox">Click here to rename the task!</span>
			<input class="nameEditor" style="display:none";></input>
			<button class="newTaskBtn">&#x002B;</button>
			<button class="collapseBtn" data-state="shown">&#x25B2;</button>
			<button class="removeBtn" style="display:none">&#x2715;</button>
			<div class="taskChildren"></div>
		</div>
	</body>
	<script>
	function isMobileDevice() {
		return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
	};
	chkFunc=function(self){
		t=self.parentElement;
		t.children[0].dataset.state=JSON.parse(t.children[0].checked);
		};
	nbFunc=function(self){
		t=self.parentElement;
		t.children[1].style.display="none";
		t.children[2].style.display="inline";
		t.children[2].focus();
		};
	neFunc=function(self){
		t=self.parentElement;
		t.children[1].innerText=t.children[2].value==""?"[Click here to rename!]":t.children[2].value;
		t.children[1].style.display="inline";
		t.children[2].style.display="none";
		};
	ntbFunc=function(self){
		t=self.parentElement;
		newT=document.createElement("div");
		newT.className="task";
		newT.dataset.level=parseInt(t.dataset.level)+1;
		t.children[6].appendChild(newT);
		
		newchk=document.createElement("input");
		newchk.type="checkbox";
		newchk.className="check";
		newchk.dataset.state="false";
		newchk.style.marginRight=parseInt(newT.dataset.level)+"EM";
		newT.appendChild(newchk);
		
		newnb=document.createElement("span");
		newnb.className="nameBox";
		newnb.style.display="none";
		newT.appendChild(newnb);
		
		newne=document.createElement("input");
		newne.className="nameEditor";
		newT.appendChild(newne);
		
		newntb=document.createElement("button");
		newntb.className="newTaskBtn";
		newntb.innerHTML="\u002B"
		newT.appendChild(newntb);
		
		newcb=document.createElement("button");
		newcb.className="collapseBtn";
		newcb.dataset.state="shown";
		newcb.innerHTML="\u25B2";
		newT.appendChild(newcb);
		
		newrm=document.createElement("button");
		newrm.className="removeBtn";
		newrm.innerHTML="\u2715";
		newT.appendChild(newrm);
		
		newch=document.createElement("div");
		newch.className="taskChildren";
		newT.appendChild(newch);
		
		newchk.addEventListener("click",function(){chkFunc(this)});
		newnb.addEventListener("click",function(){nbFunc(this)});
		newne.addEventListener("change",function(){neFunc(this)});
		if(!isMobileDevice())newne.addEventListener("focusout",function(){neFunc(this)});
		newntb.addEventListener("click",function(){ntbFunc(this)});
		newcb.addEventListener("click",function(){cbFunc(this)});
		newrm.addEventListener("click",function(){rmFunc(this)});
		
		newne.focus();
	};
	cbFunc=function(self){
		t=self.parentElement;
		if(t.children[4].dataset.state=="shown"){
			t.children[4].dataset.state="hidden";
			t.children[6].style.display="none";
			t.children[4].innerText="\u25BC";
		} else {
			t.children[4].dataset.state="shown";
			t.children[6].style.display="block";
			t.children[4].innerText="\u25B2";
		}
	};
	rmFunc=function(self){
		t=self.parentElement;
		if(t.children[6].children.length>0){
			if(!confirm("This task has subtasks. Remove?"))
			return;
		}
		t.remove();
	};
		
	window.onload=function(){
		saveBtn=document.getElementById("saveBtn");
		saveBtn.onclick=function(){
			filename=prompt("Save as?");
			if(filename==null)return;
			saveBtn.download=filename+".html";
			this.href="data:text/html;charset=UTF-8,"+encodeURIComponent(document.documentElement.outerHTML);
			filename=null;
		};
		for(task of document.getElementsByClassName("task")){
			task.children[0].addEventListener("click",function(){chkFunc(this)});
			task.children[0].checked=JSON.parse(task.children[0].dataset.state);
			task.children[1].addEventListener("click",function(){nbFunc(this)});
			task.children[2].value=task.children[1].innerText;
			task.children[2].addEventListener("change",function(){neFunc(this)});
			if(!isMobileDevice())task.children[2].addEventListener("focusout",function(){neFunc(this)});
			task.children[3].addEventListener("click",function(){ntbFunc(this)});
			task.children[4].addEventListener("click",function(){cbFunc(this)});
			task.children[5].addEventListener("click",function(){rmFunc(this)});
		};
	};
	</script>
</html>