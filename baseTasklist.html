<html>
	<body>
		<a id="saveBtn" href="#">Save this tasklist</a>
		<div class="task" id="root" data-level=0>
			<input class="check" type="checkbox"></input>
			<span class="nameBox">Click here to rename the task!</span>
			<input class="nameEditor" style="display:none";></input>
			<button class="newTaskBtn">&#x002B;</button>
			<button class="collapseBtn" data-state="expanded">&#x25BC;</button>
			<button class="removeBtn" style="display:none">&#x2715;</button>
			<div class="taskChildren"></div>
		</div>
	</body>
	<script>
	nbFunc=function(self){
		t=self.parentElement;
		t.children[1].style.display="none";
		t.children[2].style.display="inline";
		t.children[2].focus();
		};
	neFunc=function(self){
		t=self.parentElement;
		t.children[1].innerText=t.children[2].value==""?"[Click here to rename!]":t.children[2].value;
		t.children[1].style.display="inline";
		t.children[2].style.display="none";
		t.children[1].style.display="inline";
		};
	ntbFunc=function(self){
		t=self.parentElement;
		newT=document.createElement("div");
		newT.className="task";
		newT.dataset.level=parseInt(t.dataset.level)+1;
		t.children[6].appendChild(newT);
		
		newchk=document.createElement("input");
		newchk.type="checkbox";
		newchk.style.marginRight=parseInt(newT.dataset.level)+"EM";
		newT.appendChild(newchk);
		
		newnb=document.createElement("span");
		newnb.className="nameBox";
		newnb.style.display="none";
		newT.appendChild(newnb);
		
		newne=document.createElement("input");
		newne.className="nameEditor";
		newT.appendChild(newne);
		
		newntb=document.createElement("button");
		newntb.className="newTaskBtn";
		newntb.innerHTML="\u002B"
		newT.appendChild(newntb);
		
		newcb=document.createElement("button");
		newcb.className="collapseBtn";
		newcb.dataset.state="expanded";
		newcb.innerHTML="\u25BC";
		newT.appendChild(newcb);
		
		newrm=document.createElement("button");
		newrm.className="removeBtn";
		newrm.innerHTML="\u2715";
		newT.appendChild(newrm);
		
		newch=document.createElement("div");
		newch.className="taskChildren";
		newT.appendChild(newch);
		
		newnb.addEventListener("click",function(){nbFunc(this)});
		newne.addEventListener("change",function(){neFunc(this)});
		newne.addEventListener("focusout",function(){neFunc(this)});
		newntb.addEventListener("click",function(){ntbFunc(this)});
		newcb.addEventListener("click",function(){cbFunc(this)});
		newrm.addEventListener("click",function(){rmFunc(this)});
		
		newne.focus();
	};
	cbFunc=function(self){
		t=self.parentElement;
		if(t.children[4].dataset.state=="shown"){
			t.children[4].dataset.state="hidden";
			t.children[6].style.display="none";
			t.children[4].innerText="\u25BC";
		} else {
			t.children[4].dataset.state="shown";
			t.children[6].style.display="block";
			t.children[4].innerText="\u25B2";
		}
	};
	rmFunc=function(self){
		t=self.parentElement;
		if(t.children[6].children.length>0){
			if(!confirm("This task has subtasks. Remove?"))
			return;
		}
		t.remove();
	};
		
	window.onload=function(){
		saveBtn=document.getElementById("saveBtn");
		saveBtn.onclick=function(){
			filename=prompt("Save as?");
			filename=filename==null?"tasklist-"+(new Date).getTime():filename;
			saveBtn.download=filename+".html";
			this.href="data:text/html;charset=UTF-8,"+encodeURIComponent(document.documentElement.outerHTML);
		};
		tasks=document.getElementsByClassName("task");
		for(nb of document.getElementsByClassName("nameBox")){nb.addEventListener("click",function(){nbFunc(nb)});}
		for(ne of document.getElementsByClassName("nameEditor")){ne.addEventListener("input",function(){neFunc(ne)});
				ne.addEventListener("focusout",function(){neFunc(ne)});}
		for(ntb of document.getElementsByClassName("newTaskBtn")){ntb.addEventListener("click",function(){ntbFunc(ntb)});}
		for(cb of document.getElementsByClassName("collapseBtn")){cb.addEventListener("click",function(){cbFunc(cb)});}
		for(rm of document.getElementsByClassName("removeBtn")){rm.addEventListener("click",function(){rmFunc(rm)});}
	};
	</script>
</html>